<div class="users-requests row m-0" ...attributes {{did-update (perform this.start) @userTenants @triggerRefresh}}>
{{#if (eq this.available 'waiting')}}
  {{!-- WAITING --}}
  <Standard::LoadingSpinner @icon="true" @msg="Attendere prego..." @style="3" class="alert-info mb-0" />
{{else if (eq this.available 'unavailable')}}
  <Standard::LoadingSpinner @icon="true" @style="3" class="alert-danger mb-0">
    <i class="fa fa-exclamation-triangle"></i> Servizio non disponibile.
    <a href="#" class="alert-link" {{on 'click' (perform this.start)}}>Riprova</a>.
  </Standard::LoadingSpinner>
{{else}}

  <div class="col-md-12">
    <div class="card-header text-success">
      <i class="header-icon pe-7s-like2"></i> RICHIESTE DI AUTORIZZAZIONE
      {{#if (has-permissions 'canSeeAllTenants')}}
        <div class="btn-actions-pane-right">
          <div class="position-relative form-check">
            <label class="form-label form-check-label {{if this.seeAllTenantsUsers 'text-danger' 'text-secondary'}}">
              <input type="checkbox" {{on 'change' this.updateSeeAllTenantsUsers}} checked={{this.seeAllTenantsUsers}} class="form-check-input all-tenants-users">
              Vedi utenti di tutte le aziende
            </label>
          </div>
        </div>
      {{/if}}
    </div>

      {{#if (has-permissions 'User.read')}}
        <div class="card-body underline p-1">

          <div class="row">
            <div class="col-md-12 text-center mb-2 pt-2">
              <Standard::PaginationButtons @currentPageNumber={{this.currentPageNumber}} @totalRecords={{this.totalRecords}} @recordsPerPage={{this.recordsPerPage}} @cb={{this.changePageNumber}}/>
            </div>
            {{!-- campo di ricerca  --}}
            <div class="col-md-3 mb-4">
              <select {{on 'change' this.changePageSize}} class="form-control form-control-sm">
                <option value="10" selected={{(eq this.recordsPerPage '10')}}>10 utenti</option>
                <option value="20" selected={{(eq this.recordsPerPage '20')}}>20 utenti</option>
                <option value="50" selected={{(eq this.recordsPerPage '50')}}>50 utenti</option>
                <option value="100" selected={{(eq this.recordsPerPage '100')}}>100 utenti</option>
                <option value="0" selected={{(eq this.recordsPerPage '0')}}>Tutti</option>
              </select>
            </div>
            <div class="input-group mb-4 col-md-9 float-right">
              <input type="search" {{on 'input' this.insertFilter}} placeholder="..." class="find-primary-key form-control form-control-sm">
              <div class="input-group-append mr-2">
                <button class="btn btn-secondary btn-sm" disabled type="button">
                  <i class="fa fa-search"></i>
                </button>
              </div>

              <select {{on 'change' this.changeState}} class="form-control form-control-sm">
                <option value="pending" selected={{(eq this.state 'pending')}}>Solo richieste pendenti</option>
                <option value="denied" selected={{(eq this.state 'denied')}}>Solo richieste rifiutate</option>
                <option value="accepted" selected={{(eq this.state 'accepted')}}>Solo richieste accettate</option>
                <option value="" selected={{(eq this.state '')}}>Tutte le richieste</option>
              </select>

              <button class="btn btn-secondary btn-sm ml-2 pl-2 pr-2" type="button" {{on 'click' (perform this.start)}}>
                <i class="fa fa-refresh {{if this.start.isRunning 'fa-spin'}}"></i>
              </button>
            </div>
          </div>

          {{#if (eq this.recordsLength 0)}}
            <p class="m-3"><em>Non ci sono richieste da mostrare</em></p>
          {{else}}
            {{!-- #region elenco record --}}

            <table class="mae-table mb-3">
              <thead>
                <tr>
                  <th></th>
                  <th>COGNOME</th>
                  <th>NOME</th>
                  <th>E-MAIL</th>
                  <th>DATA INVIO</th>
                  <th>DATA ACCETTAZIONE</th>
                  <th>IP</th>
                  <th style="width: 104px;"></th>
                </tr>
              </thead>
              <tbody>
              {{#each this.records as |record|}}
                <tr>
                  <td class="align-middle">
                    {{#if (eq record.state 'accepted')}}
                    <div class="swatch-holder bg-success animated zoomIn"></div>
                    {{/if}}
                    {{#if (eq record.state 'pending')}}
                    <div class="swatch-holder bg-warning animated zoomIn"></div>
                    {{/if}}
                    {{#if (eq record.state 'denied')}}
                    <div class="swatch-holder bg-danger animated zoomIn"></div>
                    {{/if}}
                  </td>
                  <td class="align-middle">
                    {{record.user.userProfile.lastName}}
                  </td>
                  <td class="align-middle">
                    {{record.user.userProfile.firstName}}
                  </td>
                  <td class="align-middle">
                    {{record.user.email}}
                  </td>
                  <td class="align-middle">
                    {{this.formatDate record.createdAt}}
                  </td>
                  <td class="align-middle">
                    {{this.formatDate record.acceptedAt}}
                  </td>
                  <td class="align-middle">
                    {{#if (eq record.ip '')}}
                      --
                    {{else}}
                      {{record.ip}}
                    {{/if}}
                  </td>
                  <td class="align-middle">
                    {{#if (eq record.state 'pending')}}
                    <button {{on 'click' (fn (perform this.sendAgain) record.id)}} class="btn-undo-field btn-hover-shine btn btn-sm btn-warning" type="button">
                      REINVIA <i class="fa ml-2 {{if this.sendAgain.isRunning 'fa-spinner fa-spin' 'fa-location-arrow'}}"></i>
                    </button>
                    {{/if}}
                    {{#if (eq record.state 'denied')}}
                    <button class="btn-undo-field btn-hover-shine btn btn-sm btn-danger" type="button">
                      ANNULLA <i class="fa fa-trash ml-2"></i>
                    </button>
                    {{/if}}
                  </td>
                </tr>
              {{/each}}
              </tbody>
            </table>
            {{!-- #endregion --}}
          {{/if}}
        </div>
      {{else}}
        <div class="alert alert-danger fade show m-3" role="alert">
          <i class="fa fa-exclamation-triangle"></i> Area riservata. Impossibile accedere.
        </div>
      {{/if}}
  </div>

{{/if}}

</div>
{{yield}}
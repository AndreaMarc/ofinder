<div class="ticket-operators p-3" {{did-update (perform this.start) @lastRefresh}} ...attributes>
  {{!-- template-lint-disable require-input-label --}}
  {{#if (eq this.available 'waiting')}}
    <Standard::LoadingSpinner @icon='1' @msg="Caricamento in corso, attendere prego..." @msgKey="" @style="3" class="alert-info"/>
  {{else if (eq this.available 'unavailable')}}
    <Standard::LoadingSpinner @icon="" @style="3" class="alert-danger">
      Si è verificato un errore. <a href="#" class="ml-2" {{on 'click' (perform this.preload)}}>Riprova.</a>
    </Standard::LoadingSpinner>
  {{else if (eq (length this.areas) 0)}}
    <div class="row m-0 mb-4 underline">
      <div class="col-md-12 mb-3">
        <p class="p-3 text-warning">
          <em>Non hai ancora definito l'elenco dei Reparti.</em>
        </p>
      </div>
    </div>
  {{else}}
    <div class="row">
      <div class="col-12 mb-3">
        <div class="main-card mb-3 card">
          <div class="card-header">
            <ul class="nav nav-justified">
              <li class="nav-item">
                  <a data-toggle="tab" href="#ticket-operator-tab-0" {{on 'click' (fn this.setTab 0)}} class="nav-link {{if (eq this.activeBox 0) 'active' '' }}">ELENCO DEGLI OPERATORI</a>
              </li>
              {{#if (and this.auth.license.multiArea this.auth.custom.multiArea)}}
                <li class="nav-item">
                    <a data-toggle="tab" href="#ticket-operator-tab-1" {{on 'click' (fn this.setTab 1)}} class="nav-link {{if (eq this.activeBox 1) 'active' '' }}">ASSOCIAZIONE DEGLI OPERATORI AI REPARTI + LEADER</a>
                </li>
              {{/if}}
            </ul>
          </div>

          <div class="card-body">
            <div class="tab-content">
              {{!-- TAB 1 - ELENCO OPERATORI --}}
              <div class="tab-pane {{if (eq this.activeBox 0) 'active' '' }}" id="ticket-operator-tab-0" role="tabpanel">
                <p>Definisci l'elenco degli Operatori, cioè di coloro che possono gestire le richieste di assistenza.<br />
                  <small>Nel menù a tendina sottostante trovi l'elenco di tutti i tuoi utenti. Seleziona quelli da rendere Operatori.</small>
                </p>
                <div class="row m-0">
                  <div class="col-12 mb-4">
                    <label><strong>Elenco degli utenti.</strong></label>
                    <Standard::SelectTwo @addEmptyOption="1" @options={{this.users}} @changeCB={{this.addOperator}}/>
                  </div>

                  <div class="col-12 mb-2">
                    <label class="text-primary"><strong>I TUOI OPERATORI ({{length this.tenantOperators}})</strong></label>
                  </div>
                  <div class="col-12 mb-3">
                    {{#if (gt (length this.tenantOperators) 0)}}
                      <ul class="list-group mb-3">
                        {{#each this.tenantOperators as | operator |}}
                          <li class="list-group-item">
                            <div class="widget-content p-0">
                              <div class="widget-content-wrapper">
                                <div class="widget-content-left pl-0 col-10">
                                  <div class="widget-heading">
                                    {{operator.userProfile.lastName}} {{operator.userProfile.firstName}}
                                  </div>
                                  <div class="widget-subheading"><i>{{operator.email}}</i></div>
                                </div>
                                <div class="widget-content-right col-2 pr-0 text-right">
                                  <button {{on 'click' (fn this.deleteUserOperator operator)}} class="btn btn-sm btn-danger btn-hover-shine btn-icon-only" type="button">
                                    <i class="fa {{if (and this.deleteUserOperatorConfirmed.isRunning (eq operator.id this.deletingId)) 'fa-spinner fa-spin' 'fa-trash'}}"></i>
                                  </button>
                                </div>
                              </div>
                            </div>
                          </li>
                        {{/each}}
                      </ul>
                    {{else}}
                      <p class="text-danger"><em>Non sono presenti Operatori</em></p>
                    {{/if}}
                  </div>
                </div>
              </div>

              {{!-- TAB 2 - ASSOCIAZIONE OPERATORI AI REPARTI + LEADER --}}
              <div class="tab-pane {{if (eq this.activeBox 1) 'active' '' }}" id="ticket-operator-tab-1" role="tabpanel">
                <p>
                  Per ottimizzare al meglio i tuoi Operatori, associali a uno o più Reparti.<br />
                  <small>Nel menù a tendina trovi l'elenco di tutti i tuoi Reparti. Selezionane uno per consultare gli operatori già associati o per aggiungerne altri.</small>
                </p>

                 <div class="row m-0">
                  <div class="col-12 mb-4">
                    <label><strong>Scegli un Reparto.</strong></label>
                    <select {{on 'change' this.changeArea}} id="ticket-operator-area" class="form-control text-success">
                      {{#each this.areas as | area |}}
                        <option value={{area.id}} selected={{(eq area.id this.selectedArea)}}>{{area.name}} ({{area.operatorCount}} operatori)</option>
                      {{/each}}
                    </select>
                  </div>
                  {{#if (eq this.available2 'waiting')}}
                    <div class="col-12">
                      <Standard::LoadingSpinner @icon='1' @msg="Caricamento in corso, attendere prego..." @msgKey="" @style="3" class="alert-info"/>
                    </div>
                  {{else if (eq this.available2 'unvailable')}}
                    <div class="col-12">
                      <Standard::LoadingSpinner @icon="" @style="3" class="alert-danger">
                        Si è verificato un errore. <a href="#" class="ml-2" {{on 'click' (perform this.start)}}>Riprova.</a>
                      </Standard::LoadingSpinner>
                    </div>
                  {{else if (eq this.available2 'available')}}
                    <div class="col-12 mb-5">
                      <label><strong>Aggiungi un Operatore a questo Reparto</strong></label>
                      <Standard::ToolTip @color="black" @title="Sono mostrati i soli Operatori definiti nell'altra Tab" class="ml-1">
                        <i class="fa fa-question-circle"></i>
                      </Standard::ToolTip>
                      {{#if this.selectOperatorToAddConfirmed.isRunning}}
                        <button class="btn btn-sm btn-warning ml-3" disabled type="button">
                          <i class="fa fa-spinner fa-spin mr-2"></i> attendere prego...
                        </button>
                      {{/if}}
                      <Standard::SelectTwo @addEmptyOption="1" @options={{this.areaUsers}} @changeCB={{this.selectOperatorToAdd}}/>
                    </div>

                    {{#if (gt (length this.operators) 0)}}
                      <div class="col-12 col-md-4 mb-1">
                        <label class="text-primary">
                          <strong>OPERATORI ASSOCIATI
                            {{#if (and this.auth.license.canUseLeader this.auth.custom.canUseLeader)}}
                              (<small>{{this.masterCount}} capo-area</small>)
                            {{/if}}
                          </strong>
                        </label>
                      </div>

                      {{#if (gt this.masterCount 0)}}
                        <div class="d-none d-md-block d-lg-block col-md-8 text-right text-primary mb-1">
                          {{#if (and this.auth.license.canUseLeader this.auth.custom.canUseLeader)}}
                            <div class="position-relative form-check">
                              <input {{on 'change' this.toggleOnlyLeader}} checked={{this.onlyLeader}} type="checkbox" class="form-check-input">
                              <label class="form-check-label">Mostra solo capo-area</label>
                            </div>
                          {{/if}}
                        </div>
                        <div class="col-12 d-md-none d-lg-none mb-2 text-primary">
                          {{#if (and this.auth.license.canUseLeader this.auth.custom.canUseLeader)}}
                            <div class="position-relative form-check">
                              <input {{on 'change' this.toggleOnlyLeader}} checked={{this.onlyLeader}} type="checkbox" class="form-check-input">
                              <label class="form-check-label">Mostra solo capo-area</label>
                            </div>
                          {{/if}}
                        </div>
                      {{/if}}
                    {{/if}}

                    <div class="col-12 mb-3">
                      {{#if (eq (length this.operators) 0)}}
                        <p class="text-danger"><em>Questo Reparto non ha operatori associati!</em></p>
                      {{else}}

                        {{#if (and (eq (length this.masterCount) 0) this.auth.license.canUseLeader this.auth.custom.canUseLeader)}}
                          <Standard::LoadingSpinner @icon='' @msg='Definisci almeno un Capo-Area altrimenti le notifiche di "<em>Nuovi Ticket</em>" arriveranno a tutti gli operatori del Reparto.' @msgKey="" @style="3" class="alert-warning"/>
                        {{/if}}
                        <ul class="todo-list-wrapper list-group mb-3">
                          {{#each this.operators as | operator |}}
                            <li class="list-group-item">
                              {{!-- barra laterale colorata per leader --}}
                              {{#if operator.masterTracker}}
                                <div class="todo-indicator bg-primary"></div>
                              {{else}}
                                <div class="todo-indicator bg-secondary"></div>
                              {{/if}}
                              <div class="widget-content p-0">
                                <div class="widget-content-wrapper">
                                  {{!-- immagine utente --}}
                                  <div class="widget-content-left mr-3">
                                    <div class="widget-content-left">
                                        {{#if (eq operator.user.userProfile.profileImageId '')}}
                                          <img width="42" class="rounded-circle" src="/assets/images/avatars/user-icon.png" alt="no-image">
                                        {{else}}
                                          <div class="ticket-operator-user-image rounded-circle">
                                            <Standard::ShowImage @image={{operator.user.userProfile.profileImageId}} @size="sm" @byUrl=""/>
                                          </div>
                                        {{/if}}
                                    </div>
                                  </div>
                                  {{!-- nome --}}
                                  <div class="widget-content-left">
                                    <div class="widget-heading">
                                      {{operator.user.userProfile.lastName}} {{operator.user.userProfile.firstName}}
                                    </div>
                                  </div>
                                  <div class="widget-content-right text-right">
                                    {{#if (and this.auth.license.canUseLeader this.auth.custom.canUseLeader)}}
                                      {{#if (and this.changeLeaderStatus.isRunning (eq operator.id this.changeLeaderId))}}
                                        <button class="btn btn-sm btn-info btn-icon-only mb-1 mr-1" disabled type="button">
                                          <i class="fa spinner fa-spin"></i>
                                        </button>
                                      {{else}}
                                        <Standard::FlipSwitch @checked={{operator.masterTracker}} @size="sm" @offstyle="secondary" @onstyle="primary" @offtext="Operatore" @ontext="Capo-Area" @width="110" @cb={{(perform this.changeLeaderStatus operator)}} class="d-inline mb-2 mr-1"/>
                                      {{/if}}
                                    {{/if}}
                                    <button {{on 'click' (fn this.deleteAssociation operator)}} class="btn btn-sm btn-danger btn-hover-shine btn-icon-only mb-1" type="button">
                                      <i class="fa {{if (and this.deleteAssociationConfirmed.isRunning (eq operator.id this.deletingId)) 'fa-spinner fa-spin' 'fa-trash'}}"></i>
                                    </button>
                                  </div>
                                </div>
                              </div>
                            </li>
                          {{/each}}
                        </ul>
                      {{/if}}
                    </div>
                  {{/if}}
                 </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  {{/if}}
</div>
{{yield}}